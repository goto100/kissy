/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 13 19:05
*/
KISSY.add("tree/node-tpl",'<div id="ks-tree-node-row-{{id}}"\n     class="{{getBaseCssClasses \'row\'}}\n     {{#if selected}}\n        {{getBaseCssClasses \'selected\'}}\n     {{/if}}\n     ">\n    <div id="ks-tree-node-expand-icon-{{id}}"\n         class="{{getBaseCssClasses \'expand-icon\'}}">\n    </div>\n    {{#if checkable}}\n    <div id="ks-tree-node-checked-{{id}}"\n         class="{{getBaseCssClasses \'checked\'+checkState}}"></div>\n    {{/if}}\n    <div id="ks-tree-node-icon-{{id}}"\n         class="{{getBaseCssClasses \'icon\'}}">\n\n    </div>\n    {{{include \'component/extension/content-render/content-tpl\'}}}\n</div>\n<div id="ks-tree-node-children-{{id}}"\n     class="{{getBaseCssClasses \'children\'}}"\n{{^if expanded}}\nstyle="display:none"\n{{/if}}\n>\n</div>');
KISSY.add("tree/node-render",function(e,d,g,c,b){return g.getDefaultRender().extend([b],{beforeCreateDom:function(a,b){e.mix(a.elAttrs,{role:"tree-node","aria-labelledby":"ks-content"+a.id,"aria-expanded":a.expanded?"true":"false","aria-selected":a.selected?"true":"false","aria-level":a.depth,title:a.tooltip});e.mix(b,{expandIconEl:"#ks-tree-node-expand-icon-{id}",rowEl:"#ks-tree-node-row-{id}",iconEl:"#ks-tree-node-icon-{id}",childrenEl:"#ks-tree-node-children-{id}",checkIconEl:"#ks-tree-node-checked-{id}"})},
refreshCss:function(a,b){var i=this.control,c=i.get("iconEl"),h,d=i.get("expandIconEl"),g=i.get("childrenEl");b?(i="file-icon",h="expand-icon-{t}"):i.get("expanded")?(i="expanded-folder-icon",h="expand-icon-{t}minus"):(i="collapsed-folder-icon",h="expand-icon-{t}plus");c[0].className=this.getBaseCssClasses(i);d[0].className=this.getBaseCssClasses(e.substitute(h,{t:a?"l":"t"}));g[0].className=this.getBaseCssClasses(a?"lchildren":"children")},_onSetExpanded:function(a){this.control.get("childrenEl")[a?
"show":"hide"]();this.el.setAttribute("aria-expanded",a)},_onSetSelected:function(a){this.control.get("rowEl")[a?"addClass":"removeClass"](this.getBaseCssClasses("selected"));this.el.setAttribute("aria-selected",a)},_onSetDepth:function(a){this.el.setAttribute("aria-level",a)},_onSetCheckState:function(a){a=this.getBaseCssClasses("checked").split(/\s+/).join(a+" ")+a;this.control.get("checkIconEl").removeClass(this.getBaseCssClasses("checked0 checked1 checked2")).addClass(a)},getChildrenContainerEl:function(){return this.control.get("childrenEl")}},
{ATTRS:{contentTpl:{value:c}},HTML_PARSER:{rowEl:function(a){return a.one("."+this.getBaseCssClass("row"))},childrenEl:function(a){return a.one("."+this.getBaseCssClass("children"))},isLeaf:function(a){if(a.hasClass(this.getBaseCssClass("leaf")))return!0;if(a.hasClass(this.getBaseCssClass("folder")))return!1},expanded:function(a){return"none"!=a.one("."+this.getBaseCssClass("children")).css("display")},expandIconEl:function(a){return a.one("."+this.getBaseCssClass("expand-icon"))},checkState:function(a){if(a=
a.one("."+this.getBaseCssClass("checked")))for(var b="checked0 checked1 checked2".split(/\s+/),c=0;c<b.length;c++)if(a.hasClass(this.getBaseCssClass(b[c])))return c;return 0},iconEl:function(a){return a.one("."+this.getBaseCssClass("icon"))},checkIconEl:function(a){return a.one("."+this.getBaseCssClass("checked"))}}})},{requires:["node","component/container","./node-tpl","component/extension/content-render"]});
KISSY.add("tree/node",function(e,d,g,c){function b(f){if(f.target==this){var a=f.component,b=this.get("depth"),f=f.index,c=this.get("tree");c&&(k(c,a,b+1),n(this,f))}}function a(f){f.target==this&&(k(this.get("tree"),f.component),n(this,f.index))}function l(f){f.target===this&&this.el.setAttribute("aria-setsize",this.get("children").length)}function i(f){var a=f.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||a==f}function o(f){var a=f.get("isLeaf");return!(!1===a||void 0===a&&f.get("children").length)}
function h(f){var a=f.get("children");return!f.get("expanded")||!a.length?f:h(a[a.length-1])}function m(f){f.get&&f.view&&f.view.refreshCss(i(f),o(f))}function k(f,a,b){void 0!==b&&a.set("depth",b);e.each(a.get("children"),function(a){"number"==typeof b?k(f,a,b+1):k(f,a)})}function n(a,b){m(a);for(var b=Math.max(0,b-1),c=a.get("children"),h,d=c.length;b<d;b++)h=c[b],m(h),h.el.setAttribute("aria-posinset",b+1)}var p=d.all,j=d.KeyCode;return g.extend({bindUI:function(){this.on("afterAddChild",b);this.on("afterRemoveChild",
a);this.on("afterAddChild afterRemoveChild",l)},syncUI:function(){m(this);l.call(this,{target:this})},handleKeyDownInternal:function(a){var b=!0,c=this.get("tree"),d=this.get("expanded"),e,i=this.get("isLeaf"),g=this.get("children");switch(a.keyCode){case j.ENTER:return this.handleClickInternal(a);case j.HOME:e=c;break;case j.END:e=h(c);break;case j.UP:e=a=(a=this.prev())?h(a):this.get("parent");break;case j.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)e=a[0];else{a=this.next();for(c=
this;!a&&(c=c.get("parent"));)a=c.next();e=a}break;case j.LEFT:d&&(g.length||!1===i)?this.set("expanded",!1):e=this.get("parent");break;case j.RIGHT:if(g.length||!1===i)d?e=g[0]:this.set("expanded",!0);break;default:b=!1}e&&e.select();return b},next:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=e.indexOf(this,a);return b==a.length-1?null:a[b+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=e.indexOf(this,a);return 0===b?null:a[b-
1]},select:function(){this.set("selected",!0)},handleClickInternal:function(a){var a=p(a.target),b=this.get("expanded");this.get("tree").focus();a.equals(this.get("expandIconEl"))?this.set("expanded",!b):(this.select(),this.fire("click"));return!0},createChildren:function(){this.renderChildren.apply(this,arguments);if(this===this.get("tree")){var a=this.get("tree");a&&(k(a,this,0),n(this,0))}},_onSetExpanded:function(a){m(this);this.fire(a?"expand":"collapse")},_onSetSelected:function(a,b){var c=
this.get("tree");if(!b||!b.byPassSetTreeSelectedItem)c.set("selectedItem",a?this:null)},expandAll:function(){this.set("expanded",!0);e.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);e.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{xrender:{value:c},checkable:{value:!1,view:1},handleMouseEvents:{value:!1},isLeaf:{view:1},expandIconEl:{},iconEl:{},selected:{view:1},expanded:{sync:0,value:!1,view:1},tooltip:{view:1},tree:{getter:function(){for(var a=
this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree-node"})},{requires:["node","component/container","./node-render"]});
KISSY.add("tree/tree-manager",function(e,d,g){function c(){}var b=e.UA,a=e.Env.host.document.documentMode||b.ie,l=d.Gesture,i=e.Features.isTouchEventSupported();c.ATTRS={showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0},handleMouseEvents:{value:!0}};e.augment(c,g,{isTree:1,__bindUI:function(){var b=this.get("prefixCls")+"tree-node",c=l.tap,c=c+" ";i||(c+=a&&9>a?"dblclick ":"");this.$el.delegate(c,"."+b,this.handleChildrenEvents,this)},_onSetSelectedItem:function(a,b){a&&b.prevVal&&
b.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetShowRootNode:function(a){this.get("rowEl")[a?"show":"hide"]()}});return c},{requires:["node","component/extension/delegate-children"]});
KISSY.add("tree/control",function(e,d,g){return d.extend([g],{handleKeyDownInternal:function(c){var b=this.get("selectedItem");return b===this?this.callSuper(c):b&&b.handleKeyDownInternal(c)},_onSetFocused:function(c){this.callSuper(c);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"tree-node"}}},xclass:"tree"})},{requires:["./node","./tree-manager"]});
KISSY.add("tree/check-node",function(e,d,g){var c=d.all,d=g.extend({handleClickInternal:function(b){var a;a=this.get("expanded");var e=this.get("expandIconEl"),d=this.get("tree"),b=c(b.target);d.focus();if(b.equals(e))this.set("expanded",!a);else return a=this.get("checkState"),this.set("checkState",1==a?0:1),this.fire("click"),!0},_onSetCheckState:function(b){var a=this.get("parent"),c,d,g,h;(1==b||0==b)&&e.each(this.get("children"),function(a){a.set("checkState",b)});if(a){c=0;h=a.get("children");
for(d=0;d<h.length;d++){g=h[d];g=g.get("checkState");if(2==g){a.set("checkState",2);return}1==g&&c++}0===c?a.set("checkState",0):c==h.length?a.set("checkState",1):a.set("checkState",2)}}},{ATTRS:{checkIconEl:{},checkable:{value:!0,view:1},checkState:{value:0,sync:0,view:1},defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree-node"});e.mix(d,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});return d},{requires:["node","./node"]});
KISSY.add("tree/check-tree",function(e,d,g){return d.extend([g],{handleKeyDownInternal:function(c){var b=this.get("selectedItem");return b===this?this.callSuper(c):b&&b.handleKeyDownInternal(c)},_onSetFocused:function(c,b){this.callSuper(c,b);c&&!this.get("selectedItem")&&this.select()}},{ATTRS:{defaultChildCfg:{value:{xclass:"check-tree-node"}}},xclass:"check-tree"})},{requires:["./check-node","./tree-manager"]});
KISSY.add("tree",function(e,d,g,c,b){d.Node=g;d.CheckNode=c;d.CheckTree=b;return d},{requires:["tree/control","tree/node","tree/check-node","tree/check-tree"]});
