/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 13 19:04
*/
KISSY.add("menubutton/menubutton-tpl","{{{include 'component/extension/content-render/content-tpl'}}}\n<div class=\"{{getBaseCssClasses 'dropdown'}}\">\n    <div class=\"{{getBaseCssClasses 'dropdown-inner'}}\">\n    </div>\n</div>");
KISSY.add("menubutton/render",function(d,a,f,j){return a.getDefaultRender().extend([j],{decorateDom:function(g){var h=this.control,d=h.get("prefixCls"),g=g.one("."+d+"popupmenu"),a=g[0].ownerDocument.body;a.insertBefore(g[0],a.firstChild);a=this.getComponentConstructorByNode(d,g);h.setInternal("menu",new a({srcNode:g,prefixCls:d}))},beforeCreateDom:function(a){d.mix(a.elAttrs,{"aria-expanded":!1,"aria-haspopup":!0})},_onSetCollapsed:function(a){var d=this.$el,f=this.getBaseCssClass("open");d[a?"removeClass":
"addClass"](f).attr("aria-expanded",!a)}},{ATTRS:{contentTpl:{value:f}}})},{requires:["button","./menubutton-tpl","component/extension/content-render"]});
KISSY.add("menubutton/control",function(d,a,f,j,g,h){function l(b){b.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function k(b){b.target.isMenu&&(b=b.newVal,this.el.setAttribute("aria-activedescendant",b&&b.el.id||""))}var i=a.KeyCode;return f.extend({isMenuButton:1,_onSetCollapsed:function(b){var e=this.get("menu");if(b)e.hide();else if(b=this.$el,!e.get("visible")){var a={node:b,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};d.mix(e.get("align"),a,!1);this.get("matchElWidth")&&
(e.render(),a=e.get("el"),a=(parseInt(a.css("borderLeftWidth"))||0)+(parseInt(a.css("borderRightWidth"))||0),e.set("width",e.get("align").node[0].offsetWidth-a));e.show();b.attr("aria-haspopup",e.get("el").attr("id"))}},bindUI:function(){this.on("afterHighlightedItemChange",k,this);this.on("click",l,this)},handleKeyDownInternal:function(b){var e=b.keyCode,a=""+b.type,d=this.get("menu");if(e==i.SPACE){if(b.preventDefault(),"keyup"!=a)return h}else if("keydown"!=a)return h;return d.get("rendered")&&
d.get("visible")?(b=d.handleKeyDownInternal(b),e==i.ESC?(this.set("collapsed",!0),!0):b):e==i.SPACE||e==i.DOWN||e==i.UP?(this.set("collapsed",!1),!0):h},handleClickInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlurInternal:function(b){this.callSuper(b);this.set("collapsed",!0)},addItem:function(b,a){this.get("menu").addChild(b,a)},removeItem:function(b,a){this.get("menu").removeChild(b,a)},removeItems:function(b){var a=this.get("menu");a&&(a.removeChildren?a.removeChildren(b):
a.children&&(a.children=[]))},getItemAt:function(b){var a=self.get("menu");return a.get("rendered")&&a.getChildAt(b)},_onSetDisabled:function(a){!a&&this.set("collapsed",!0)},destructor:function(){this.get("menu").destroy()}},{ATTRS:{matchElWidth:{value:!0},collapseOnClick:{value:!1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&a.setInternal("parent",this)}},collapsed:{value:!1,
view:1},xrender:{value:j}},xclass:"menu-button"})},{requires:["node","button","./render","menu"]});KISSY.add("menubutton/option",function(d,a){return a.Item.extend({},{ATTRS:{selectable:{value:!0},textContent:{}},xclass:"option"})},{requires:["menu"]});
KISSY.add("menubutton/select",function(d,a,f,j,g,h){function l(a){var c=a.get("menu"),c=c.children||c.get&&c.get("children")||[],a=a.get("value"),b,d;for(d=0;d<c.length;d++)if(b=c[d],k(b)==a)return b;return null}function k(a){var c;if(a)if(a.get){if((c=a.get("value"))===h)c=a.get("textContent")||a.get("content")}else if((c=a.value)===h)c=a.textContent||a.content;return c}function i(a){var c=a.get("menu"),b=a.get("value"),a=c&&c.get&&c.get("children");d.each(a,function(a){a&&a.set&&a.set("selected",
k(a)==b)})}function b(a){var c=l(this),b=this.get("menu");a.target===b&&((a=c||b.getChildAt(0))&&a.set("highlighted",!0),c&&c.set("selected",!0))}function e(a){var c=l(a),b=c&&(c.textContent||c.get&&c.get("textContent")),c=c&&(c.content||c.get&&c.get("content"));a.set("content",b||c||a.get("defaultCaption"))}function n(a){a=a.target;if(a.isMenuItem){var a=k(a),c=this.get("value");this.set("value",a);a!=c&&this.fire("change",{prevVal:c,newVal:a})}}var m=f.extend({bindUI:function(){this.on("click",
n,this);this.on("show",b,this)},removeItems:function(){this.callSuper.apply(this,arguments);this.set("value",null)},removeItem:function(a,c){this.callSuper(a,c);a.get("value")==this.get("value")&&this.set("value",null)},_onSetValue:function(){i(this);e(this)},_onSetDefaultCaption:function(){e(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(b,c){b=d.one(b);c=c||{};c.elBefore=b;var e,f=[],g,i=null,j=b.val();b.all("option").each(function(a){var b={xclass:"option",
content:a.text(),elCls:a.attr("class"),value:a.val()};j==a.val()&&(i={content:b.content,value:b.value});f.push(b)});d.mix(c,{menu:d.mix({children:f},c.menuCfg)});delete c.menuCfg;g=(new m(d.mix(c,i))).render();if(e=b.attr("name")){var k=(new a("<input type='hidden' name='"+e+"' value='"+j+"'>")).insertBefore(b,h);g.on("afterValueChange",function(a){k.val(a.newVal||"")})}b.remove();return g},xclass:"select"});return m},{requires:["node","./control","menu","./option"]});
KISSY.add("menubutton",function(d,a,f,j){a.Select=f;a.Option=j;return a},{requires:["menubutton/control","menubutton/select","menubutton/option"]});
