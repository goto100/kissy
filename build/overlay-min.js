/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 13 22:54
*/
KISSY.add("overlay/extension/loading",function(f,g){function d(){}d.prototype={loading:function(){this._loadingExtEl||(this._loadingExtEl=(new g("<div class='"+this.get("prefixCls")+"ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'/>")).appendTo(this.$el));this._loadingExtEl.show()},unloading:function(){var a=this._loadingExtEl;a&&a.hide()}};return d},{requires:["node"]});
KISSY.add("overlay/extension/mask",function(f,g){function d(a){a=a.view.getBaseCssClasses("mask");a=n("<div  style='width:"+(b?"expression(KISSY.DOM.docWidth())":"100%")+";left:0;top:0;height:"+(b?"expression(KISSY.DOM.docHeight())":"100%")+";position:"+(b?"absolute":"fixed")+";' class='"+a+"'>"+(b?"<iframe style='position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'></iframe>":
"")+"</div>").prependTo("body");a.unselectable();a.on("mousedown",function(a){a.preventDefault()});return a}function a(){}function c(a,h){var b=a.get("maskNode"),c=a.view.getBaseCssClasses("mask-hidden");h?b.removeClass(c):b.addClass(c)}function e(a,h,b,e){var d=a.effect||l;c(e,b);if(d!=l){var e=a.duration,a=a.easing,f=b?1:0;h.stop(1,1);h.css("display",b?l:"block");h[d+o[d][f]](e,function(){h.css("display","")},a)}}function h(a){var h=this.get("maskNode");if(a=a.newVal){var b=Number(this.$el.css("z-index"));
isNaN(b)||h.css("z-index",b)}e(this.get("mask"),h,a,this)}var b=6===f.UA.ie,n=g.all;a.ATTRS={mask:{value:!1},maskNode:{}};var l="none",o={fade:["Out","In"],slide:["Up","Down"]};a.prototype={__renderUI:function(){this.get("mask")&&this.set("maskNode",d(this))},__bindUI:function(){var a,b;if(b=this.get("mask")){a=this.get("maskNode");if(b.closeOnClick)a.on(g.Gesture.tap,this.close,this);this.on("afterVisibleChange",h)}},__destructor:function(){var a;(a=this.get("maskNode"))&&a.remove()}};return a},
{requires:["node"]});KISSY.add("overlay/close-tpl",'<a href="javascript:void(\'close\')"\n   id="ks-overlay-close-{{id}}"\n   class="{{getBaseCssClasses "close"}}"\n   role=\'button\'>\n    <span class="{{getBaseCssClasses "close-x"}}">close</span>\n</a>');
KISSY.add("overlay/overlay-render",function(f,g,d,a,c){return g.getDefaultRender().extend([d,a],{createDom:function(){this.control.get("closable")&&(this.control.$contentEl.append(this.renderTpl(c)),this.fillChildrenElsBySelectors({closeBtn:"#ks-overlay-close-{id}"}))}},{HTML_PARSER:{closeBtn:function(a){return a.one("."+this.getBaseCssClass("close"))}}})},{requires:["component/container","component/extension/content-render","component/extension/shim-render","./close-tpl"]});
KISSY.add("overlay/extension/overlay-effect",function(f){function g(a){var b=a.$el.clone(!0);b.css({visibility:"visible",overflow:"hidden"}).addClass(a.get("prefixCls")+"overlay-ghost");return a.__afterCreateEffectGhost(b)}function d(a,b,c){a.__effectGhost&&a.__effectGhost.stop(1,1);var e=a.$el,d=f.all,j=a.get("effect"),i=d(j.target),d=j.duration,i=f.mix(i.offset(),{width:i.width(),height:i.height()}),m=f.mix(e.offset(),{width:e.width(),height:e.height()}),k=g(a),j=j.easing;k.insertAfter(e);b?(b=
i,i=m):b=m;e.css("visibility","hidden");k.css(b);a.__effectGhost=k;k.animate(i,{duration:d,easing:j,complete:function(){a.__effectGhost=null;k.remove();e.css("visibility","");c()}})}function a(a,b,c){var f=a.$el,g=a.get("effect"),j=g.effect||"none",i=g.target;"none"==j&&!i?c():i?d(a,b,c):(a=g.duration,g=g.easing,i=b?1:0,f.stop(1,1),f.css({visibility:"visible",display:b?"none":"block"}),f[j+e[j][i]](a,function(){f.css({display:"block",visibility:""});c()},g))}function c(){}var e={fade:["Out","In"],
slide:["Up","Down"]};c.ATTRS={effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var b=a.effect;"string"==typeof b&&!e[b]&&(a.effect="")}}};c.prototype={__afterCreateEffectGhost:function(a){return a},_onSetVisible:function(c){var b=this;a(b,c,function(){b.fire(c?"show":"hide")})}};return c});
KISSY.add("overlay/control",function(f,g,d,a,c,e,h){var b={hide:"hide",destroy:"destroy"};return g.extend([a,d,c,h],{bindUI:function(){var a=this,b=a.get("closeBtn");if(b)b.on("click",function(b){a.close();b.preventDefault()})},close:function(){this[b[this.get("closeAction")]||"hide"]();return this}},{ATTRS:{contentEl:{},closable:{value:!1,view:1},closeBtn:{view:1},closeAction:{value:"hide"},focusable:{value:!1},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},visible:{value:!1},xrender:{value:e}},
xclass:"overlay"})},{requires:"component/container,component/extension/align,./extension/loading,./extension/mask,./overlay-render,./extension/overlay-effect".split(",")});KISSY.add("overlay/dialog-tpl",'<div class="{{getBaseCssClasses \'header\'}}"\n     style="\n{{#each headerStyle}} \n {{xkey}}:{{.}};  \n{{/each}}\n"\n     id="ks-stdmod-header-{{id}}">{{{headerContent}}}</div>\n\n<div class="{{getBaseCssClasses \'body\'}}"\n     style="\n{{#each bodyStyle}} \n {{xkey}}:{{.}};  \n{{/each}}\n"\n     id="ks-stdmod-body-{{id}}">{{{bodyContent}}}</div>\n\n<div class="{{getBaseCssClasses \'footer\'}}"\n     style="\n{{#each footerStyle}} \n {{xkey}}:{{.}};  \n{{/each}}\n"\n     id="ks-stdmod-footer-{{id}}">{{{footerContent}}}</div>');
KISSY.add("overlay/dialog-render",function(f,g,d){return g.extend({beforeCreateDom:function(a){f.mix(a.elAttrs,{role:"dialog","aria-labelledby":"ks-stdmod-header-"+this.control.get("id")})},createDom:function(){this.$contentEl.append(this.renderTpl(d));this.$el.append('<div tabindex="0"></div>');this.fillChildrenElsBySelectors({header:"#ks-stdmod-header-{id}",body:"#ks-stdmod-body-{id}",footer:"#ks-stdmod-footer-{id}"})},getChildrenContainerEl:function(){return this.control.get("body")},_onSetBodyStyle:function(a){this.control.get("body").css(a)},
_onSetHeaderStyle:function(a){this.control.get("header").css(a)},_onSetFooterStyle:function(a){this.control.get("footer").css(a)},_onSetBodyContent:function(a){var c;c=this.control.get("body");c.html(a)},_onSetHeaderContent:function(a){var c;c=this.control.get("header");c.html(a)},_onSetFooterContent:function(a){var c;c=this.control.get("footer");c.html(a)}},{HTML_PARSER:{header:function(a){return a.one("."+this.getBaseCssClass("header"))},body:function(a){return a.one("."+this.getBaseCssClass("body"))},
footer:function(a){return a.one("."+this.getBaseCssClass("footer"))},headerContent:function(a){return a.one("."+this.getBaseCssClass("header")).html()},bodyContent:function(a){return a.one("."+this.getBaseCssClass("body")).html()},footerContent:function(a){return(a=a.one("."+this.getBaseCssClass("footer")))&&a.html()}}})},{requires:["./overlay-render","./dialog-tpl","./close-tpl"]});
KISSY.add("overlay/dialog",function(f,g,d,a){var f=g.extend({__afterCreateEffectGhost:function(a){var c=this.get("body");a.all("."+this.get("prefixCls")+"stdmod-body").css({height:c.height(),width:c.width()}).html("");return a},handleKeyDownInternal:function(e){if(this.get("escapeToClose")&&e.keyCode===a.KeyCode.ESC){if("select"!=e.target.nodeName.toLowerCase()||e.target.disabled)this.close(),e.halt()}else a:if(e.keyCode==c){var d=this.$el,b=a.all(e.target),f=d.last();if(b.equals(el)&&e.shiftKey)f[0].focus(),
e.halt();else if(b.equals(f)&&!e.shiftKey)this.focus(),e.halt();else if(b.equals(d)||d.contains(b))break a;e.halt()}},_onSetVisible:function(a,c){var b=this.el;if(a)this.__lastActive=b.ownerDocument.activeElement,this.focus(),b.setAttribute("aria-hidden","false");else{b.setAttribute("aria-hidden","true");try{this.__lastActive&&this.__lastActive.focus()}catch(d){}}this.callSuper(a,c)}},{ATTRS:{header:{view:1},body:{view:1},footer:{view:1},bodyStyle:{value:{},view:1},footerStyle:{value:{},view:1},headerStyle:{value:{},
view:1},headerContent:{value:"",view:1},bodyContent:{value:"",view:1},footerContent:{value:"",view:1},closable:{value:!0},xrender:{value:d},focusable:{value:!0},escapeToClose:{value:!0}},xclass:"dialog"}),c=a.KeyCode.TAB;return f},{requires:["./control","./dialog-render","node"]});
KISSY.add("overlay/popup",function(f,g,d){return g.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,c=a.get("trigger"),e;a.__mouseEnterPopup=function(c){a._clearHiddenTimer();e=f.later(function(){a._showing(c);e=d},1E3*a.get("mouseDelay"))};c.on("mouseenter",a.__mouseEnterPopup);a._mouseLeavePopup=function(){e&&
(e.cancel(),e=d);a._setHiddenTimer()};c.on("mouseleave",a._mouseLeavePopup)},_bindContainerMouse:function(){this.$el.on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=f.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=d)},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(c){c.halt();if(a.get("toggle"))a[a.get("visible")?
"_hiding":"_showing"](c);else a._showing(c)};a.get("trigger").on("click",a.__clickPopup)},_showing:function(a){this.set("currentTrigger",f.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",d);this.hide()},destructor:function(){var a=this.$el,c=this.get("trigger");c&&(this.__clickPopup&&c.detach("click",this.__clickPopup),this.__mouseEnterPopup&&c.detach("mouseenter",this.__mouseEnterPopup),this._mouseLeavePopup&&c.detach("mouseleave",this._mouseLeavePopup));a.detach("mouseleave",
this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,this)}},{ATTRS:{trigger:{setter:function(a){return f.all(a)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}},xclass:"popup"})},{requires:["./control"]});KISSY.add("overlay",function(f,g,d,a){g.Dialog=d;f.Dialog=d;g.Popup=a;return f.Overlay=g},{requires:["overlay/control","overlay/dialog","overlay/popup"]});
