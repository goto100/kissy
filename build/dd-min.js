/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 13 18:49
*/
KISSY.add("dd/ddm",function(i,f,k,h){function j(g){var a,d;if(g.touches&&1<g.touches.length)p._end();else{if(a=this.__activeToDrag)a._move(g);else if(d=this.get("activeDrag"))d._move(g),this.__needDropCheck&&b(this,g,d);(a=a||d)&&a.get("preventDefaultOnMove")&&g.preventDefault()}}function b(g,b,d){var c=g.get("validDrops"),o=d.get("mode"),e=0,m=0,f=l(d.get("node")),n=q(f);i.each(c,function(g){if(g.get("disabled"))return h;var c;c=g.getNodeFromTarget(b,d.get("dragNode")[0],d.get("node")[0]);if(!c)return h;
if("point"==o)s(l(c),d.mousePos)&&(c=q(l(c)),e?c<m&&(e=g,m=c):(e=g,m=c));else if("intersect"==o)c=q(a(f,l(c))),c>m&&(m=c,e=g);else if("strict"==o&&(c=q(a(f,l(c))),c==n))return e=g,!1;return h});if((c=g.get("activeDrop"))&&c!=e)c._handleOut(b),d._handleOut(b);g.setInternal("activeDrop",e);e&&(c!=e?e._handleEnter(b):e._handleOver(b))}function e(g){g._shim=u('<div style="background-color:red;position:'+(v?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+p.get("dragCursor")+";z-index:"+
B+';"></div>').prependTo(t.body||t.documentElement).css("opacity",0);e=d;if(v)C.on("resize scroll",w,g);d(g)}function d(g){var a=g.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==c&&(c=g.get("dragCursor"));g._shim.css({cursor:c,display:"block"});v&&w.call(g)}function m(g){var a=g.get("drops");g.setInternal("validDrops",[]);a.length&&i.each(a,function(g){g._active()})}function n(g){var a=g.get("drops");g.setInternal("validDrops",[]);a.length&&i.each(a,function(g){g._deActive()})}
function l(g){var a=g.offset();return{left:a.left,right:a.left+(g.__dd_cached_width||g.outerWidth()),top:a.top,bottom:a.top+(g.__dd_cached_height||g.outerHeight())}}function s(a,c){return a.left<=c.left&&a.right>=c.left&&a.top<=c.top&&a.bottom>=c.top}function q(a){return a.top>=a.bottom||a.left>=a.right?0:(a.right-a.left)*(a.bottom-a.top)}function a(a,c){var b=Math.max(a.top,c.top),d=Math.min(a.right,c.right),e=Math.min(a.bottom,c.bottom);return{left:Math.max(a.left,c.left),right:d,top:b,bottom:e}}
function c(a){a&&(a.__dd_cached_width=a.outerWidth(),a.__dd_cached_height=a.outerHeight())}var o=i.UA,u=f.all,x=i.Env.host,t=x.document,r=u(t),C=u(x),v=6===o.ie,B=999999,f=f.Gesture,y=f.move,z=f.end,k=k.extend({__activeToDrag:0,_regDrop:function(a){this.get("drops").push(a)},_unRegDrop:function(a){var c=this.get("drops"),a=i.indexOf(a,c);-1!=a&&c.splice(a,1)},_regToDrag:function(a){this.__activeToDrag=a;r.on(z,this._end,this);r.on(y,A,this);6===o.ie&&t.body.setCapture()},_start:function(){this.get("drops");
var a=this.__activeToDrag;this.setInternal("activeDrag",a);this.__activeToDrag=0;a.get("shim")&&e(this);this.__needDropCheck=0;a.get("groups")&&(m(this),this.get("validDrops").length&&(c(a.get("node")),this.__needDropCheck=1))},_addValidDrop:function(a){this.get("validDrops").push(a)},_end:function(a){var c=this.__activeToDrag,b=this.get("activeDrag"),d=this.get("activeDrop");a&&(c&&c._move(a),b&&b._move(a));r.detach(y,A,this);r.detach(z,this._end,this);6===o.ie&&t.body.releaseCapture();c&&(c._end(a),
this.__activeToDrag=0);this._shim&&this._shim.hide();b&&(b._end(a),n(this),d&&d._end(a),this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}},{ATTRS:{dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}}}),A=o.ie&&8>o.ie?i.throttle(j,30):j,w=i.throttle(function(){var a;(a=this.get("activeDrag"))&&a.get("shim")&&this._shim.css({width:r.width(),height:r.height()})},30),p=new k;p.inRegion=s;p.region=
l;p.area=q;p.cacheWH=c;p.PREFIX_CLS="ks-dd-";return p},{requires:["node","base"]});
KISSY.add("dd/draggable",function(i,f,k,h){function j(){return!1}var b=f.all,e=i.each,d=i.Features,m=i.UA.ie,n=h.PREFIX_CLS,l=i.Env.host.document,s,q=function(a){var c=a.target;this._checkDragStartValid(a)&&this._checkHandler(c)&&this._prepare(a)};return k.extend({initializer:function(){this.addTarget(h);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a);this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(f.Gesture.start,q,this).on("dragstart",this._fixDragStart)},
detachDragEvent:function(a){a=this;a.get("node").detach(f.Gesture.start,q,a).detach("dragstart",a._fixDragStart)},_bufferTimer:null,_onSetDisabledChange:function(a){this.get("dragNode")[a?"addClass":"removeClass"](n+"-disabled")},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var c=this,b=c.get("handlers"),d=0;e(b,function(b){if(b[0]==a||b.contains(a))return d=1,c.setInternal("activeHandler",b),!1});return d},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&
1!=a.which||this.get("disabled")?0:1},_prepare:function(a){if(a){var c=this;m&&(s=l.body.onselectstart,l.body.onselectstart=j);c.get("halt")&&a.stopPropagation();d.isTouchEventSupported()||a.preventDefault();var b=a.pageX,e=a.pageY;c.setInternal("startMousePos",c.mousePos={left:b,top:e});if(c._allowMove){var f=c.get("node").offset();c.setInternal("startNodePos",f);c.setInternal("deltaPos",{left:b-f.left,top:e-f.top})}h._regToDrag(c);if(b=c.get("bufferTime"))c._bufferTimer=setTimeout(function(){c._start(a)},
1E3*b)}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(a){var c=a.pageX,b=a.pageY;if(!this.get("dragging")){var d=this.get("startMousePos"),e=0,m=this.get("clickPixelThresh");if(Math.abs(c-d.left)>=m||Math.abs(b-d.top)>=m)this._start(a),e=1;if(!e)return}this.mousePos={left:c,top:b};a.drag=this;if(d=this._allowMove)e=this.get("deltaPos"),c-=e.left,b-=e.top,a.left=c,a.top=b,this.setInternal("actualPos",{left:c,top:b}),this.fire("dragalign",
a);b=1;!1===this.fire("drag",a)&&(b=0);b&&d&&this.get("node").offset(this.get("actualPos"))},stopDrag:function(){h._end()},_end:function(a){var a=a||{},b;this._clearBufferTimer();m&&(l.body.onselectstart=s);this.get("dragging")&&(this.get("node").removeClass(n+"drag-over"),(b=h.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this,pageX:a.pageX,pageY:a.pageY}))},_handleOut:function(){this.get("node").removeClass(n+
"drag-over");this.fire("dragexit",{drag:this,drop:h.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(n+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(a){this._clearBufferTimer();this.setInternal("dragging",1);this.setInternal("dragStartMousePos",{left:a.pageX,top:a.pageY});h._start();this.fire("dragstart",{drag:this,pageX:a.pageX,pageY:a.pageY})},destructor:function(){this.detachDragEvent();this.detach()}},{name:"Draggable",
ATTRS:{node:{setter:function(a){if(!(a instanceof f))return b(a)}},clickPixelThresh:{valueFn:function(){return h.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return h.get("bufferTime")}},dragNode:{},shim:{value:!1},handlers:{value:[],getter:function(a){var c=this;a.length||(a[0]=c.get("node"));e(a,function(d,e){"function"===typeof d&&(d=d.call(c));"string"==typeof d&&(d=c.get("node").one(d));d.nodeType&&(d=b(d));a[e]=d});c.setInternal("handlers",a);return a}},activeHandler:{},dragging:{value:!1,
setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](n+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startMousePos:{},dragStartMousePos:{},startNodePos:{},deltaPos:{},actualPos:{},preventDefaultOnMove:{value:!0}},inheritedStatics:{DropMode:{POINT:"point",INTERSECT:"intersect",STRICT:"strict"}}})},{requires:["node","base","./ddm"]});
KISSY.add("dd/draggable-delegate",function(i,f,k,h){var j=f.PREFIX_CLS,b=h.all,e=function(d){var e,f;if(this._checkDragStartValid(d)){e=this.get("handlers");var h=b(d.target);(e=e.length?this._getHandler(h):h)&&(f=this._getNode(e));f&&(this.setInternal("activeHandler",e),this.setInternal("node",f),this.setInternal("dragNode",f),this._prepare(d))}};return k.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},_onSetDisabledChange:function(b){this.get("container")[b?"addClass":
"removeClass"](j+"-disabled")},bindDragEvent:function(){this.get("container").on(h.Gesture.start,e,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(h.Gesture.start,e,this).detach("dragstart",this._fixDragStart)},_getHandler:function(b){for(var e=void 0,f=this.get("container"),h=this.get("handlers");b&&b[0]!==f[0];){i.each(h,function(f){if(b.test(f))return e=b,!1});if(e)break;b=b.parent()}return e},_getNode:function(b){return b.closest(this.get("selector"),
this.get("container"))}},{ATTRS:{container:{setter:function(e){return b(e)}},selector:{},handlers:{value:[],getter:0}}})},{requires:["./ddm","./draggable","node"]});
KISSY.add("dd/droppable",function(i,f,k,h){var j=h.PREFIX_CLS;return k.extend({initializer:function(){this.addTarget(h);h._regDrop(this)},getNodeFromTarget:function(b,e,d){var b=this.get("node"),f=b[0];return f==e||f==d?null:b},_active:function(){var b=h.get("activeDrag"),e=this.get("node"),d=this.get("groups"),b=b.get("groups");a:if(!0===b)d=1;else{for(var f in d)if(b[f]){d=1;break a}d=0}d?(h._addValidDrop(this),e&&(e.addClass(j+"drop-active-valid"),h.cacheWH(e))):e&&e.addClass(j+"drop-active-invalid")},
_deActive:function(){var b=this.get("node");b&&b.removeClass(j+"drop-active-valid").removeClass(j+"drop-active-invalid")},__getCustomEvt:function(b){return i.mix({drag:h.get("activeDrag"),drop:this},b)},_handleOut:function(){var b=this.__getCustomEvt();this.get("node").removeClass(j+"drop-over");this.fire("dropexit",b)},_handleEnter:function(b){b=this.__getCustomEvt(b);b.drag._handleEnter(b);this.get("node").addClass(j+"drop-over");this.fire("dropenter",b)},_handleOver:function(b){b=this.__getCustomEvt(b);
b.drag._handleOver(b);this.fire("dropover",b)},_end:function(){var b=this.__getCustomEvt();this.get("node").removeClass(j+"drop-over");this.fire("drophit",b)},destructor:function(){h._unRegDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(b){if(b)return f.one(b)}},groups:{value:{}},disabled:{}}})},{requires:["node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(i,f,k,h){function j(){var b=this.get("container"),d=[],h=this.get("selector");b.all(h).each(function(b){f.cacheWH(b);d.push(b)});this.__allNodes=d}var b=k.extend({initializer:function(){f.on("dragstart",j,this)},getNodeFromTarget:function(b,d,h){var j={left:b.pageX,top:b.pageY},b=this.__allNodes,l=0,k=Number.MAX_VALUE;b&&i.each(b,function(b){var a=b[0];a===h||a===d||(a=f.region(b),f.inRegion(a,j)&&(a=f.area(a),a<k&&(k=a,l=b)))});l&&(this.setInternal("lastNode",
this.get("node")),this.setInternal("node",l));return l},_handleOut:function(){this.callSuper();this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(e){var d=this.get("node"),f=b.superclass._handleOut,h=this.callSuper,i=b.superclass._handleEnter,j=this.get("lastNode");j[0]!==d[0]?(this.setInternal("node",j),f.apply(this,arguments),this.setInternal("node",d),i.call(this,e)):h.call(this,e)},_end:function(b){this.callSuper(b);this.setInternal("node",0)}},{ATTRS:{lastNode:{},
selector:{},container:{setter:function(b){return h.one(b)}}}});return b},{requires:["./ddm","./droppable","node"]});KISSY.add("dd",function(i,f,k,h,j,b){i={Draggable:k,DDM:f,Droppable:j,DroppableDelegate:b,DraggableDelegate:h};return KISSY.DD=i},{requires:["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable","dd/droppable-delegate"]});
