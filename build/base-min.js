/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Aug 13 22:31
*/
KISSY.add("base/attribute",function(h,y,j){function n(a,b){return"string"==typeof b?a[b]:b}function o(a,b,d,g,e,c,f,m){f=f||d;return a.fire(b+h.ucfirst(d)+"Change",h.mix({attrName:f,subAttrName:c,prevVal:g,newVal:e},m))}function k(a,b,d){var g=a[b];!d&&!g&&(a[b]=g={});return g||{}}function i(a){return k(a,"__attrs")}function r(a){return k(a,"__attrVals")}function w(a,b){for(var d=0,g=b.length;a!=j&&d<g;d++)a=a[b[d]];return a}function x(a){var b;-1!==a.indexOf(".")&&(b=a.split("."),a=b.shift());return{path:b,
name:a}}function s(a,b,d){var g=d;if(b){var a=g=a===j?{}:h.clone(a),e=b.length-1;if(0<=e){for(var c=0;c<e;c++)a=a[b[c]];a!=j&&(a[b[c]]=d)}}return g}function t(a,b,d,g,e){var c,l,m;c=x(b);var i=b,b=c.name;c=c.path;m=a.get(b);var p=b,A=k(a,"__defaultBeforeFns");A[p]||(A[p]=1,p="before"+h.ucfirst(p)+"Change",a.publish(p,{defaultFn:u}));c&&(l=w(m,c));if(!g.force&&(!c&&m===d||c&&l===d))return j;d=s(m,c,d);d=h.mix({attrName:b,subAttrName:i,prevVal:m,newVal:d,_opts:g,_attrs:e,target:a},g.data);if(g.silent){if(f===
u.call(a,d))return f}else if(f===a.fire("before"+h.ucfirst(b)+"Change",d))return f;return a}function u(a){if(a.target!==this)return j;var b=a.newVal,d=a.prevVal,c=a.attrName,e=a.subAttrName,h=a._attrs,a=a._opts,b=this.setInternal(c,b);if(b===f)return b;a.silent||(b=r(this)[c],o(this,"after",c,d,b,e,null,a.data),h?h.push({prevVal:d,newVal:b,attrName:c,subAttrName:e}):o(this,"","*",[d],[b],[e],[c],a.data));return j}function q(){}function v(a,b){var d=i(a),c=k(d,b,1),e=c.valueFn;if(e&&(e=n(a,e)))e=e.call(a),
e!==j&&(c.value=e),delete c.valueFn,d[b]=c;return c.value}function z(a,b,d,c){var e,f;e=x(b);b=e.name;if(e=e.path)f=a.get(b),d=s(f,e,d);if((e=k(i(a),b).validator)&&(e=n(a,e)))if(a=e.call(a,d,b,c),a!==j&&!0!==a)return a;return j}q.INVALID={};var c=q.INVALID,f=!1;h.augment(q,y.Target,{getAttrs:function(){return i(this)},getAttrVals:function(){var a={},b,d=i(this);for(b in d)a[b]=this.get(b);return a},addAttr:function(a,b,d){var c=i(this),e,b=h.clone(b);(e=c[a])?h.mix(e,b,d):c[a]=b;return this},addAttrs:function(a,
b){var d=this;h.each(a,function(a,b){d.addAttr(b,a)});b&&d.set(b);return d},hasAttr:function(a){return i(this).hasOwnProperty(a)},removeAttr:function(a){this.hasAttr(a)&&(delete i(this)[a],delete r(this)[a]);return this},set:function(a,b,d){if(h.isPlainObject(a)){var d=b||{},b=Object(a),c=[],e,i=[];for(a in b)(e=z(this,a,b[a],b))!==j&&i.push(e);if(i.length)return d.error&&d.error(i),f;for(a in b)t(this,a,b[a],d,c);var l=[],m=[],k=[],p=[];h.each(c,function(a){m.push(a.prevVal);k.push(a.newVal);l.push(a.attrName);
p.push(a.subAttrName)});l.length&&o(this,"","*",m,k,p,l,d.data);return this}d=d||{};e=z(this,a,b);return e!==j?(d.error&&d.error(e),f):t(this,a,b,d)},setInternal:function(a,b){var d=j,g=k(i(this),a).setter;if(g&&(g=n(this,g)))d=g.call(this,b,a);if(d===c)return f;d!==j&&(b=d);r(this)[a]=b;return j},get:function(a){var b,d=r(this),c,e;-1!==a.indexOf(".")&&(b=a.split("."),a=b.shift());c=k(i(this),a,1).getter;e=a in d?d[a]:v(this,a);if(c&&(c=n(this,c)))e=c.call(this,e,a);!(a in d)&&e!==j&&(d[a]=e);b&&
(e=w(e,b));return e},reset:function(a,b){if("string"==typeof a)return this.hasAttr(a)?this.set(a,v(this,a),b):this;var b=a,c=i(this),f={};for(a in c)f[a]=v(this,a);this.set(f,b);return this}});return q},{requires:["event/custom"]});
KISSY.add("base",function(h,y){function j(c,f){return f.toUpperCase()}function n(c,f){return function(a){return function(){f?a.apply(this,arguments):this.callSuper.apply(this,arguments);var b=arguments.callee.__owner__.__extensions__||[];f&&b.reverse();var d=arguments,g;if(g=b&&b.length)for(var e=0;e<g;e++){var h=b[e]&&(!c?b[e]:b[e].prototype[c]);h&&h.apply(this,d||[])}f?this.callSuper.apply(this,arguments):a.apply(this,arguments)}}}function o(c){var f=this.constructor;for(this.userConfig=c;f;){var a=
f[t];if(a){var b=void 0;for(b in a)this.addAttr(b,a[b],!1)}f=f.superclass?f.superclass.constructor:null}if(c)for(var d in c)this.setInternal(d,c[d]);var c=this.get("listeners"),g;for(g in c)this.on(g,c[g]);this.initializer();r(this);s.call(this,"pluginInitializer");this.bindInternal();this.syncInternal()}function k(c){x(c,this,this.__hooks__||{});h.mix(this.prototype,c)}function i(c){var f;c.target==this&&(f=this[q+c.type.slice(5).slice(0,-6)],f.call(this,c.newVal,c))}function r(c){var f=c.get("plugins");
h.each(f,function(a,b){"function"===typeof a&&(f[b]=new a)})}function w(c){return function(){return c.apply(this,arguments)}}function x(c,f,a){if(f.__extensions__.length)for(b in a)c[b]=c[b]||v;for(var b in a)b in c&&(c[b]=a[b](c[b]));h.each(c,function(a,b){if("function"==typeof a){var e=0;if(a.__owner__){var h=a.__owner__;delete a.__owner__;delete a.__name__;var e=a.__wrapped__=1,i=w(a);i.__owner__=h;i.__name__=b;h.prototype[b]=i}else a.__wrapped__&&(e=1);e&&(c[b]=a=w(a));a.__owner__=f;a.__name__=
b}})}function s(c){var f,a=this.get("plugins");if(f=a.length)for(var b=0;b<f;b++)a[b][c]&&a[b][c](this)}var t="ATTRS",u=h.ucfirst,q="_onSet",v=h.noop,z=/(?:^|-)([a-z])/ig;h.augment(o,y,{initializer:v,__getHook:n,__callPluginsMethod:s,callSuper:function(){var c,f,a=arguments;"function"==typeof this&&this.__name__?(c=this,f=a[0],a=Array.prototype.slice.call(a,1)):(c=arguments.callee.caller,c.__wrapped__&&(c=c.caller),f=this);var b=c.__name__;if(b)return c=c.__owner__.superclass[b],!c?void 0:c.apply(f,
a||[])},bindInternal:function(){var c=this.getAttrs(),f,a;for(f in c)if(a=q+u(f),this[a])this.on("after"+u(f)+"Change",i)},syncInternal:function(){var c=[],f;f=this.constructor;for(var a=this.getAttrs();f;)c.push(f),f=f.superclass&&f.superclass.constructor;c.reverse();for(f=0;f<c.length;f++){var b=c[f].ATTRS||{},d;for(d in b)if(d in a){var g,e;(e=this[q+u(d)])&&0!==a[d].sync&&void 0!==(g=this.get(d))&&e.call(this,g)}}},plug:function(c){"function"===typeof c&&(c=new c);c.pluginInitializer&&c.pluginInitializer(this);
this.get("plugins").push(c);return this},unplug:function(c){var f=[],a=this,b="string"==typeof c;h.each(a.get("plugins"),function(d){var g=0,e;c&&(b?(e=d.get&&d.get("pluginId")||d.pluginId,e!=c&&(f.push(d),g=1)):d!=c&&(f.push(d),g=1));g||d.pluginDestructor(a)});a.setInternal("plugins",f);return a},getPlugin:function(c){var f=null;h.each(this.get("plugins"),function(a){if((a.get&&a.get("pluginId")||a.pluginId)==c)return f=a,!1});return f},destructor:h.noop,destroy:function(){this.get("destroyed")||
(s.call(this,"pluginDestructor"),this.destructor(),this.detach(),this.set("destroyed",!0),this.fire("destroy"))}});h.mix(o,{name:"Base",__hooks__:{initializer:n(),destructor:n("__destructor",!0)},ATTRS:{plugins:{value:[]},destroyed:{value:!1},listeners:{value:[]}},extend:function f(a,b,d){var g,e;h.isArray(a)||(d=b,b=a,a=[]);d=d||{};g=d.name||"BaseDerived";b=h.merge(b);b.hasOwnProperty("constructor")?e=b.constructor:eval("SubClass = function "+g.replace(z,j)+"(){ this.callSuper.apply(this, arguments);}");
b.constructor=e;if(g=this.__hooks__)d.__hooks__=h.merge(g,d.__hooks__);e.__extensions__=a;x(b,e,d.__hooks__||{});g=this.prototype;g=g.__inheritedStatics__=g.__inheritedStatics__||d.inheritedStatics;d.inheritedStatics&&g!==d.inheritedStatics&&h.mix(g,d.inheritedStatics);g&&h.mix(e,g);delete d.inheritedStatics;h.extend(e,this,b,d);if(a.length){var i={},l={};h.each(a.concat(e),function(a){if(a){h.each(a[t],function(a,b){var d=i[b]=i[b]||{};h.mix(d,a)});var a=a.prototype,b;for(b in a)a.hasOwnProperty(b)&&
(l[b]=a[b])}});e[t]=i;l.constructor=e;h.augment(e,l)}e.extend=e.extend||f;e.addMembers=k;return e}});o.INVALID=y.INVALID;return h.Base=o},{requires:["base/attribute","event/custom"]});
